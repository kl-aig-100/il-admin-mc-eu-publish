import{r as h,g as v,ak as B,al as E,j as t,h as $,a as y,a5 as n,u as T,L as j,T as q,b as S,F as x,am as L,a3 as M}from"./index-1dad7262.js";import{Q as F,D as z,C as V,M as W,g as A,T as D}from"./table-wrapper-53a553d0.js";import{F as C}from"./form-custom-checkbox-0c0993f0.js";const U=h.forwardRef(({bsPrefix:e,className:a,as:c="div",...r},d)=>{const p=v(e,"row"),w=B(),l=E(),f=`${p}-cols`,i=[];return w.forEach(o=>{const u=r[o];delete r[o];let s;u!=null&&typeof u=="object"?{cols:s}=u:s=u;const g=o!==l?`-${o}`:"";s!=null&&i.push(`${f}${g}-${s}`)}),t(c,{ref:d,...r,className:$(a,p,...i)})});U.displayName="Row";const K=U,G=async e=>{let a;return e.id?a=await y.put(`user/${e.id}`,e):a=await y.post("user",e),a.data},k=n.object({id:n.string().optional(),email:n.string().min(1,"The email is required").email({message:"Email is not valid."}),isResetPassword:n.optional(n.boolean()),userRoles:n.array(n.object({id:n.string(),name:n.string()})),password:n.optional(n.string())}).refine(e=>!(e.isResetPassword===!0&&!e.password),{path:["password"],message:"Password is required."}).refine(e=>!(e.isResetPassword===!0&&e.password&&e.password.length<6),{path:["password"],message:"Password must be at least 6 characters."}).refine(e=>!(e.isResetPassword===!0&&e.password&&e.password.length>25),{path:["password"],message:"Password must be less than 25 characters."}).refine(e=>!(e.isResetPassword===!0&&e.password&&!/[A-Z]/.test(e.password)),{path:["password"],message:"Password must contain at least one uppercase letter."}).refine(e=>!(e.isResetPassword===!0&&e.password&&!/[a-z]/.test(e.password)),{path:["password"],message:"Password must contain at least one lowercase letter."}).refine(e=>!(e.isResetPassword===!0&&e.password&&!/[^a-zA-Z0-9]/.test(e.password)),{path:["password"],message:"Password must contain at least one non alphanumeric character."}),O=async e=>{const a=await y.get(`user/${e}`),{data:{content:c}}=a;return k.parse(c)},Q=n.object({id:n.string(),name:n.string()}),Z=async()=>{const e=await y.get("role/GetAll"),{data:{content:a}}=e;return Q.array().parse(a)},H=({selectedItemId:e,mode:a})=>{const{reset:c,setValue:r,getValues:d}=T(),[p,w]=h.useState(!1),[l,f]=h.useState(!1),i=a==="edit",[o,u]=h.useState({email:"",password:"",userRoles:[],id:""}),s=async()=>{try{if(w(!0),c(),i){const m=await O(e);c(m),u(m),r("isResetPassword",!1)}else r("email",""),r("password",""),r("id",""),r("isResetPassword",!0),f(!0),r("userRoles",[])}catch{console.error("err")}finally{w(!1)}};if(h.useEffect(()=>{s()},[]),p)return t(j,{minHeight:"20.5vh"});const g=()=>{f(m=>!m),r("isResetPassword",!l),r("password","")},I=m=>{o.email=d("email");const b=o.userRoles.findIndex(P=>P.name===m.name);b>-1?o.userRoles.splice(b,1):o.userRoles.push(m),u(o),c(o)};return t(q,{children:S("div",{className:"row",children:[t(x,{label:"Email",name:"email",type:"text",col:i?5:6,placeholder:"Email",disabled:i}),t(x,{label:"Password",name:"password",type:"text",col:i?4:6,placeholder:i?l?"New Password":"**********":"Password",disabled:!l}),i&&t(C,{label:"Reset Password",labelTop:!0,name:"isResetPassword",col:3,type:"checkbox",defaultValue:l,handleChange:g}),t(L,{className:"form-group col-12 mt-3",children:t(M.Label,{children:"Roles"})}),t(K,{children:t(F,{queryFn:Z,queryKey:"Roles",children:(m,b,P)=>m.map(R=>t(C,{label:R.name,name:R.name,col:6,type:"checkbox",defaultValue:o.userRoles.some(N=>N.name===R.name),handleChange:()=>I(R)},R==null?void 0:R.id))})})]})})},Y=async e=>(await y.delete(`user/${e}`)).data,_=()=>{const[e,a]=h.useState(""),[c,r]=h.useState(!1),[d,p]=h.useState("new"),[w,l]=h.useState(!1),f=s=>{if(w){l(!1);return}a(s),r(!0),p("edit")},i=s=>{s==null||s.stopPropagation(),l(!w)};return{selectedItemId:e,show:c,setShow:r,columns:[{id:1,data:"email",label:"Email",align:"left",width:"20%"},{id:2,data:"userRoles",label:"Roles",align:"left",render:s=>s.userRoles.map(g=>t("span",{className:"badge bg-primary me-1",children:g.name},g.id))},{id:3,data:"actions",width:"20%",render:s=>t("div",{className:"d-flex align-items-center justify-content-center",children:t(z,{bodyText:`Do you want to remove the user ${s.email}?`,cancelText:"No",confirmText:"Yes",data:s.id,onDelete:Y,queryKey:"user",title:"Delete User",handleOnClick:i})})}],mode:d,setMode:p,onRowClick:(s,g)=>{f(s==null?void 0:s.id)}}},se=()=>{const{show:e,setShow:a,selectedItemId:c,columns:r,mode:d,setMode:p,onRowClick:w}=_(),l="user",f=()=>{a(!0),p("new")};return S("div",{className:"card-container",children:[t(V,{show:!0,children:t(W,{onSubmit:G,schema:k,modalSize:"lg",title:d==="edit"?"Edit User":"New User",show:e,setShow:a,queryKey:l,mode:d,icon:"bi bi-person-circle",submitCloseTextButton:d==="view"?void 0:"Save & Close",children:t(H,{selectedItemId:c,mode:d})})}),t(F,{queryFn:()=>A("User/GetUsersWithPagination"),queryKey:l,children:(i,o,u)=>t(D,{title:"User",columns:r,data:i,isLoading:u,refetch:o,icon:"bi bi-person-circle",actions:{new:f},row:{onRowClick:w}})})]})};export{se as default};
