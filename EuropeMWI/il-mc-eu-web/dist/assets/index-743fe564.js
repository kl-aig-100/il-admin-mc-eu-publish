import{D as h,u as C,r as f,j as e,au as v,K as j,at as k,R as F,B as x,p as T,L as I,n as A,C as D}from"./index-473ea636.js";import{u as _,D as M,F as B}from"./FormWrapper-7b37d978.js";import{u as L,C as Y}from"./ContainerCard-0b0b01a3.js";import{B as g,b as c,j as N}from"./Navigation-44e5a3e6.js";import{G as y,B as O,u as S,a as z}from"./ButtonSteps-68f2fe5d.js";import{f as G,s as R,g as w}from"./europe.identifiers-f1731223.js";import{c as q,C as U,d as W,L as $,a as K,b as P,e as Q}from"./files.helper-3d2c03c3.js";import{s as b}from"./steps-schema-ebd653c1.js";import"./FormHelperText-ed336a26.js";const X=async n=>(await h.post("ecommerce/step1",n)).data,H=()=>{const{token:n,country:t,language:o}=C(),[l,i]=f.useState(!0),u=_({mutationFn:async()=>{const s=await q({token:n,country:t,redirectFrom:"fromMarcos"}),r=await X({sessionId:s.content,language:o,country:t});R({id:r.content,name:"ecommerce"})},onSuccess:()=>i(!1),onError:()=>i(!1)}),m=async()=>await u.mutateAsync();return f.useEffect(()=>{var r;((r=G())==null?void 0:r.id)?i(!1):m()},[]),{isLoading:l}},J=async n=>(await h.put("ecommerce/step1",n)).data,V=({isLoading:n,application:t})=>{var o;return e.jsx(g,{component:"div",display:"flex",alignItems:"center",marginTop:2,children:e.jsxs(y,{container:!0,children:[e.jsx(y,{item:!0,md:12,xs:12,children:e.jsx(U,{xs:12,attribute:"checkTerms",label:e.jsx(c,{identifier:"ecommerce_step1_checkTerms_text"}),checked:(o=t==null?void 0:t.checkTerms)!=null?o:!1,disabled:t==null?void 0:t.closed})}),e.jsx(O,{isLoading:n,isFinished:t==null?void 0:t.closed})]})})},Z=async(n,t,o)=>(await h.get("Ecommerce/download/document",{params:{country:n,language:t,documentType:o}})).data,ee=()=>{const n=N(),t=S(n.breakpoints.up("lg")),o=S(n.breakpoints.up("sm")),{language:l,country:i}=C(),u=_({mutationFn:async s=>await v.promise(Z(i,l,s),{loading:e.jsx(c,{identifier:"ecommerce_loading_"+s,settings:{variant:"body2"}}),success:e.jsx(c,{identifier:"document_download_success",keyStorage:j.COMMONS,settings:{variant:"body2"}}),error:e.jsx(c,{identifier:"document_download_error",keyStorage:j.COMMONS,settings:{variant:"body2"}})}),onSuccess:s=>{const{content:r,statusCode:a}=s;if(a===200){const{file:d,fileName:p,contentType:E}=r;W({file:d,contentType:E,fileName:p})}}}),m=[{title:"ecommerce_terms_title",icon:e.jsx(K,{fontSize:"large",color:"primary"}),description:"ecommerce_terms_text",documentType:"terms"},{title:"ecommerce_ipid_title",icon:e.jsx(P,{fontSize:"large",color:"primary"}),description:"ecommerce_ipid_text",documentType:"ipid"},{title:"ecommerce_faq_title",icon:e.jsx(Q,{fontSize:"large",color:"primary"}),description:"ecommerce_faq_text",documentType:"faq"}];return e.jsx(g,{flex:1,display:"flex",flexDirection:o?"row":"column",justifyContent:"space-between",alignItems:"center",sx:t?{padding:"0 15rem"}:{padding:"0 0rem"},children:m.map((s,r)=>e.jsxs(f.Fragment,{children:[e.jsx(g,{component:"div",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",paddingY:2,children:e.jsx($,{icon:s.icon,title:s.title,description:s.description,onClick:()=>u.mutateAsync(s.documentType)})},r),e.jsx(k,{show:r!==m.length-1,children:e.jsx(M,{orientation:o?"vertical":"horizontal",flexItem:!0})})]},r))})},te=()=>e.jsxs(F.Fragment,{children:[e.jsx(c,{identifier:"ecommerce_step1_subtitle",settings:{variant:"h4",marginY:1}}),e.jsx(c,{identifier:"ecommerce_step1_information_part1",settings:{variant:"body1",marginY:1}}),e.jsx(c,{identifier:"ecommerce_step1_information_part2",settings:{variant:"body1",marginY:1}}),e.jsx(x,{component:"div",sx:{flexGrow:1},marginTop:2,display:"flex",children:e.jsx(ee,{})})]}),le=()=>{var r;const{step:n}=T(a=>a),{handleChangeStep:t}=I(),{isLoading:o}=H(),{handleFetchApplication:l,application:i}=A(),{handleMessageError:u,handleStepError:m}=L(a=>a),s=_({mutationFn:async a=>{const d=w(),p=b.parse({...a,id:d});return await J(p)},onSuccess:async a=>{if(!a.content)return;const d=w();await l(d!=null?d:0),t(n+1),m(void 0),u(void 0)},onError:()=>{m(0),u("ecommerce_error_message_step_1")}});return o?e.jsx(D,{showNavigation:!1}):e.jsxs(x,{component:"div",children:[e.jsx(x,{className:"bg-header bg-header-ecommerce",children:e.jsx(c,{identifier:"ecommerce_step1_header_title",isLoading:o,settings:{paddingX:10,paddingY:3,color:"white",variant:"h3"}})}),e.jsx(z,{application:"ecommerce",completed:(r=i.closed)!=null?r:!1}),e.jsxs(Y,{children:[e.jsx(te,{}),e.jsx(B,{schema:b,onSubmit:s.mutateAsync,children:e.jsx(V,{isLoading:s.isLoading,application:i})})]})]})};export{le as default};
